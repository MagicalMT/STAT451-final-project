---
title: "Project"
author: "TaoZhang, Gefei Shen, Xuhao Wang, simon xiong"
date: "2024-11-10"
output: html_document
runtime: shiny
---

```{r, echo=FALSE}
suppressPackageStartupMessages({
  library(shiny)
  library(dplyr)
  library(ggplot2)
  library(reshape2)
  library(corrplot)
  library(ggcorrplot)
})
```

```{r, echo=FALSE}
data <- read.csv("user_behavior_dataset.csv")

# Define UI
ui <- fluidPage(
  titlePanel("User Behavior Analysis Dashboard"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("ageGroup", "Select Age Group for Analysis:", 
                  choices = c("18-28", "29-38", "39-48", "49-60", "60+")),
      selectInput("gender", "Select Gender for Screen Time Analysis:",
                  choices = c("Male", "Female", "Both")),
      checkboxInput("showCorr", "Show Correlation Matrix", value = FALSE)
    ),
    
    mainPanel(
      tabsetPanel(
        tabPanel("Operating System Preference", 
                 plotOutput("osPreference")),
        tabPanel("Screen Time by Age Group", 
                 plotOutput("screenTimeByAge"),
                 plotOutput("screenTimeByAgeSmoothed")),
        tabPanel("App Usage and Screen Time Correlation", 
                 plotOutput("corrMatrix"),
                 conditionalPanel(
                   condition = "input.showCorr == true",
                   plotOutput("heatMap")
                 )),
        tabPanel("App Usage Time Distribution", 
                 plotOutput("appUsageBoxplot")),
        tabPanel("Fake Dataset Validation", 
                 plotOutput("distributionPlot"),
                 plotOutput("scatterPlot"))
      )
    )
  )
)

# Define Server
server <- function(input, output, session) {
  # Prepare data for Operating System Preference
  data$Age_Group <- cut(data$Age, breaks = c(18, 28, 38, 48, 60, Inf), 
                        labels = c("18-28", "29-38", "39-48", "49-60", "60+"), right = FALSE)
  
  os_counts <- data %>%
    group_by(Age_Group, Operating.System) %>%
    summarise(Count = n()) %>%
    group_by(Age_Group) %>%
    mutate(Percentage = Count / sum(Count) * 100) %>%
    ungroup()
  
  output$osPreference <- renderPlot({
    ggplot(os_counts %>% filter(Age_Group == input$ageGroup), 
           aes(x = "", y = Percentage, fill = Operating.System)) +
      geom_bar(stat = "identity", width = 1) +
      coord_polar("y") +
      labs(title = paste("Preferred Operating Systems for Age Group:", input$ageGroup),
           fill = "Operating System") +
      theme_void() +
      theme(legend.position = "right") +
      geom_text(aes(label = paste0(round(Percentage, 1), "%")), 
                position = position_stack(vjust = 0.5))
  })
  
  # Screen Time Analysis
  screen_time <- data %>%
    group_by(Age_Group, Gender) %>%
    summarise(Average_Screen_Time = mean(Screen.On.Time..hours.day., na.rm = TRUE), .groups = "drop")
  
  output$screenTimeByAge <- renderPlot({
    ggplot(screen_time, aes(x = Age_Group, y = Average_Screen_Time, color = Gender, group = Gender)) +
      geom_line() +
      geom_point() +
      labs(title = "Screen Time by Age Group and Gender",
           x = "Age Group",
           y = "Average Screen On Time (hours/day)") +
      theme_minimal()
  })
  
  screen_time_individual <- data %>%
    group_by(Age, Gender) %>%
    summarise(Average_Screen_On_Time = mean(Screen.On.Time..hours.day., na.rm = TRUE), .groups = "drop")
  
  output$screenTimeByAgeSmoothed <- renderPlot({
    ggplot(screen_time_individual, aes(x = Age, y = Average_Screen_On_Time, color = Gender, group = Gender)) +
      geom_point(alpha = 0.6) +
      geom_smooth(method = "loess", span = 0.3, se = FALSE) +
      scale_color_manual(values = c("Male" = "blue", "Female" = "red")) +
      labs(title = "Smoothed Screen Time Trend by Age and Gender",
           x = "Age",
           y = "Average Screen On Time (hours/day)") +
      theme_minimal()
  })
  
  # Correlation Matrix
  correlation_data <- data %>%
    select(App.Usage.Time..min.day., Screen.On.Time..hours.day., Number.of.Apps.Installed, Age)
  
  correlation_matrix <- cor(correlation_data, use = "complete.obs")
  
  output$corrMatrix <- renderPlot({
    corrplot(correlation_matrix, method = "color", type = "upper", tl.srt = 45,
             title = "Correlation Matrix",
             addCoef.col = "red")
  })
  
  output$heatMap <- renderPlot({
    ggcorrplot(correlation_matrix, method = "circle", type = "lower", lab = TRUE, lab_size = 3,
               title = "Correlation Heatmap", 
               colors = c("blue", "white", "red"))
  })
  
  # App Usage Distribution
  output$appUsageBoxplot <- renderPlot({
    ggplot(data, aes(x = Age_Group, y = App.Usage.Time..min.day.)) +
      geom_boxplot(fill = "lightblue", color = "darkblue") +
      labs(title = "Distribution of App Usage Time Across Age Groups",
           x = "Age Group",
           y = "Daily App Usage Time (minutes)") +
      theme_minimal()
  })
  
  # Fake Dataset Validation
  output$distributionPlot <- renderPlot({
    ggplot(data, aes(x = App.Usage.Time..min.day.)) +
      geom_histogram(binwidth = 30, fill = "lightblue", color = "darkblue") +
      labs(title = "Distribution of App Usage Time", 
           x = "Daily App Usage Time (minutes)", 
           y = "Frequency") +
      theme_minimal()
  })
  
  output$scatterPlot <- renderPlot({
    ggplot(data, aes(x = Number.of.Apps.Installed, y = App.Usage.Time..min.day.)) +
      geom_point(alpha = 0.6, color = "blue") +
      labs(title = "App Usage Time vs Number of Apps Installed", 
           x = "Number of Apps Installed", 
           y = "Daily App Usage Time (minutes)") +
      theme_minimal()
  })
}

# Run the application 
shinyApp(ui = ui, server = server)
```

